{% extends 'ECBApp/base.html' %}
{% load static %}

{% block breadcrumb %}
    <a href="{% url 'dashboard' %}" class="breadcrumb-item">Home</a> / 
    <a href="{% url 'history' %}" class="breadcrumb-item">History</a>
{% endblock %}

{% block header_title %}
    Payment and Usage History
{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History</title>
    <link rel="stylesheet" href="{% static 'css/history.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h2 class="page-title">Payment and Usage History</h2>

        <div class="chart-section">
            <h3>Monthly Payments (Histogram)</h3>
            <canvas id="paymentHistogram"></canvas>
        </div>

        <div class="chart-section">
            <h3>Monthly Usage (Histogram)</h3>
            <canvas id="usageHistogram"></canvas>
        </div>

        <div class="chart-section">
            <h3>Yearly Payment Trend (Line Graph)</h3>
            <canvas id="paymentLineGraph"></canvas>
        </div>

        <div class="chart-section">
            <h3>Yearly Usage Trend (Line Graph)</h3>
            <canvas id="usageLineGraph"></canvas>
        </div>
    </div>

    <script>
        // Data from backend
        const paymentMonths = JSON.parse('{{ payment_months|escapejs }}');
        const paymentTotals = JSON.parse('{{ payment_totals|escapejs }}');
        const usageMonths = JSON.parse('{{ usage_months|escapejs }}');
        const usageTotals = JSON.parse('{{ usage_totals|escapejs }}');
        const yearlyPaymentData = JSON.parse('{{ yearly_payment_data|escapejs }}');
        const yearlyUsageData = JSON.parse('{{ yearly_usage_data|escapejs }}');
        const years = JSON.parse('{{ years|escapejs }}');

        // Payment Histogram
        new Chart(document.getElementById('paymentHistogram').getContext('2d'), {
            type: 'bar',
            data: {
                labels: paymentMonths,
                datasets: [{
                    label: 'Monthly Payments (₱)',
                    data: paymentTotals,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Usage Histogram
        new Chart(document.getElementById('usageHistogram').getContext('2d'), {
            type: 'bar',
            data: {
                labels: usageMonths,
                datasets: [{
                    label: 'Monthly Usage (kWh)',
                    data: usageTotals,
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Yearly Payment Line Graph
        new Chart(document.getElementById('paymentLineGraph').getContext('2d'), {
            type: 'line',
            data: {
                labels: years,
                datasets: [{
                    label: 'Yearly Payments (₱)',
                    data: yearlyPaymentData,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Yearly Usage Line Graph
        new Chart(document.getElementById('usageLineGraph').getContext('2d'), {
            type: 'line',
            data: {
                labels: years,
                datasets: [{
                    label: 'Yearly Usage (kWh)',
                    data: yearlyUsageData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html>
{% endblock %}
